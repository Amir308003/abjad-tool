<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>محاسبه‌گر ابجد | Abjad Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --emerald-deep: #064e3b;
            --emerald-light: #065f46;
            --gold-primary: #d4af37;
            --gold-gradient: linear-gradient(135deg, #f59e0b, #d4af37, #b45309);
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #f0f4f0;
            background-image: url("https://www.transparenttextures.com/patterns/arabesque.png");
            color: #1a2e1a;
        }

        .gold-border {
            border: 2px solid transparent;
            border-image: var(--gold-gradient);
            border-image-slice: 1;
        }

        .gold-text {
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(6, 78, 59, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        .tab-btn.active {
            background: var(--emerald-deep);
            color: var(--gold-primary);
            box-shadow: 0 4px 15px rgba(6, 78, 59, 0.3);
        }

        .char-cell {
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid #e2e8f0;
        }

        .char-cell:hover {
            transform: translateY(-2px);
            border-color: var(--gold-primary);
        }

        .char-cell.active-highlight {
            background-color: #fee2e2;
            border-color: #ef4444;
            color: #b91c1c;
        }

        .highlighted-char {
            color: #ef4444;
            font-weight: bold;
            background-color: #fee2e2;
            padding: 0 2px;
            border-radius: 2px;
        }

        textarea, select, input {
            border: 1px solid #d1d5db;
            transition: all 0.3s;
        }

        textarea:focus, select:focus, input:focus {
            outline: none;
            border-color: var(--gold-primary);
            ring: 2px rgba(212, 175, 55, 0.2);
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: var(--emerald-light);
            border-radius: 10px;
        }
    </style>
</head>
<body class="min-h-screen py-10 px-4">

    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold gold-text mb-2">محاسبه‌گر هوشمند ابجد</h1>
            <p class="text-emerald-900 opacity-80">استخراج اسرار اعداد از میان کلمات</p>
            <div class="h-1 w-24 bg-gradient-to-r from-transparent via-[#d4af37] to-transparent mx-auto mt-4"></div>
        </header>

        <!-- Main Card -->
        <div class="card overflow-hidden">
            <!-- Tabs -->
            <div class="flex border-b border-emerald-100 bg-emerald-50/50">
                <button onclick="switchTab('text-to-num')" id="tab-btn-text" class="tab-btn active flex-1 py-4 font-bold transition-all">تبدیل متن به عدد</button>
                <button onclick="switchTab('num-to-text')" id="tab-btn-num" class="tab-btn flex-1 py-4 font-bold transition-all">تبدیل عدد به حروف</button>
            </div>

            <div class="p-6 md:p-8">
                <!-- Tab 1: Text to Number -->
                <div id="text-to-num-content" class="space-y-6">
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="flex-1">
                            <label class="block text-emerald-900 font-bold mb-2">متن خود را وارد کنید:</label>
                            <textarea id="text-input" class="w-full h-32 p-4 rounded-xl resize-none text-lg" placeholder="مثلاً: علی"></textarea>
                        </div>
                        <div class="md:w-48">
                            <label class="block text-emerald-900 font-bold mb-2">نوع ابجد:</label>
                            <select id="abjad-type" class="w-full p-3 rounded-xl bg-white cursor-pointer">
                                <option value="kabir">ابجد کبیر (جمل)</option>
                                <option value="vasit">ابجد وسیط</option>
                                <option value="saghir">ابجد صغیر</option>
                            </select>
                        </div>
                    </div>

                    <!-- Results Display -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="md:col-span-1 bg-emerald-900 text-white p-6 rounded-2xl flex flex-col items-center justify-center shadow-xl relative overflow-hidden">
                            <div class="absolute top-0 right-0 p-2 opacity-10">
                                <svg width="80" height="80" viewBox="0 0 24 24" fill="currentColor"><path d="M19,3H5C3.89,3 3,3.89 3,5V19C3,20.11 3.89,21 5,21H19C20.11,21 21,20.11 21,19V5C21,3.89 20.11,3 19,3M19,19H5V5H19V19M11.5,7H13V10.5H16.5V12H13V15.5H11.5V12H8V10.5H11.5V7Z"/></svg>
                            </div>
                            <span class="text-emerald-200 text-sm mb-1 uppercase tracking-wider">حاصل محاسبه</span>
                            <span id="abjad-value" class="text-5xl font-bold text-gold-primary">۰</span>
                        </div>
                        <div class="md:col-span-2 bg-white border border-emerald-100 p-4 rounded-2xl">
                            <span class="text-xs text-emerald-600 block mb-2">روند محاسبه:</span>
                            <div id="calculation-details" class="custom-scrollbar overflow-y-auto max-h-24 text-sm leading-relaxed text-emerald-800">
                                منتظر ورود متن...
                            </div>
                        </div>
                    </div>

                    <!-- Statistics & Highlight -->
                    <div class="space-y-4 pt-4 border-t border-emerald-50">
                        <h3 class="font-bold text-emerald-900 flex items-center gap-2">
                            <span class="w-2 h-2 bg-gold-primary rounded-full"></span>
                            آمار حروف و تفکیک
                        </h3>
                        <div id="letters-stats-container" class="flex flex-wrap gap-2">
                            <!-- Stats will be injected here -->
                        </div>
                        <div id="highlighted-display" class="p-4 bg-emerald-50/30 rounded-xl min-h-[60px] border border-dashed border-emerald-200 text-lg leading-loose">
                            <!-- Highlighted text will be injected here -->
                        </div>
                    </div>
                </div>

                <!-- Tab 2: Number to Text -->
                <div id="num-to-text-content" class="hidden space-y-6">
                    <div>
                        <label class="block text-emerald-900 font-bold mb-2">اعداد مورد نظر را وارد کنید (هر عدد در یک خط):</label>
                        <textarea id="number-input" class="w-full h-32 p-4 rounded-xl resize-none text-lg" placeholder="مثلاً: 110"></textarea>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="p-6 bg-white border-2 gold-border rounded-xl">
                            <span class="text-xs text-emerald-600 block mb-2 font-bold">معادل حروف (ابجد کبیر):</span>
                            <div id="reverse-result" class="text-3xl font-bold text-emerald-900 min-h-[40px]">
                                -
                            </div>
                        </div>
                        <div class="p-6 bg-emerald-50 rounded-xl">
                            <span class="text-xs text-emerald-600 block mb-2 font-bold">آنالیز عدد:</span>
                            <div id="reverse-details" class="text-sm text-emerald-800 leading-relaxed min-h-[40px]">
                                -
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Footer/Hadith Section -->
            <footer class="bg-emerald-900 p-4 text-center">
                <div id="random-hadith" class="text-emerald-100 text-xs italic opacity-90">
                    «اَلْعِلْمُ کَنْزٌ عَظیمٌ لا یَفْنی؛ علم گنج بزرگی است که تمام نمی‌شود.»
                </div>
            </footer>
        </div>
        
        <div class="mt-8 text-center text-emerald-700 text-sm opacity-60">
            طراحی شده با الهام از سنت‌های اصیل اسلامی و تکنولوژی مدرن
        </div>
    </div>

    <script>
        // --- Core Abjad Logic ---

        const abjadKabirMap = {
            'ا': 1, 'آ': 1, 'أ': 1, 'إ': 1,
            'ب': 2, 'پ': 2, 'ج': 3, 'چ': 3, 'د': 4, 'ه': 5, 'و': 6, 'ؤ': 6,
            'ز': 7, 'ژ': 7, 'ح': 8, 'ط': 9, 'ی': 10, 'ي': 10, 'ئ': 10,
            'ک': 20, 'ك': 20, 'گ': 20, 'ل': 30, 'م': 40, 'ن': 50, 'س': 60,
            'ع': 70, 'ف': 80, 'ص': 90, 'ق': 100, 'ر': 200, 'ش': 300,
            'ت': 400, 'ة': 400, 'ث': 500, 'خ': 600, 'ذ': 700, 'ض': 800,
            'ظ': 900, 'غ': 1000
        };

        const abjadVasitMap = {
            'ا': 1, 'آ': 1, 'أ': 1, 'إ': 1, 'ب': 2, 'پ': 2, 'ج': 3, 'چ': 3,
            'د': 4, 'ه': 5, 'و': 6, 'ز': 7, 'ژ': 7, 'ح': 8, 'ط': 9, 'ی': 10,
            'ي': 10, 'ک': 11, 'ك': 11, 'گ': 11, 'ل': 12, 'م': 13, 'ن': 14,
            'س': 15, 'ع': 16, 'ف': 17, 'ص': 18, 'ق': 19, 'ر': 20, 'ش': 21,
            'ت': 22, 'ث': 23, 'خ': 24, 'ذ': 25, 'ض': 26, 'ظ': 27, 'غ': 28
        };

        const abjadSaghirMap = {
            'ا': 1, 'آ': 1, 'أ': 1, 'إ': 1, 'ب': 2, 'پ': 2, 'ج': 3, 'چ': 3,
            'د': 4, 'ه': 5, 'و': 6, 'ؤ': 6, 'ز': 7, 'ژ': 7, 'ح': 8, 'ط': 9,
            'ی': 10, 'ي': 10, 'ئ': 10, 'ک': 8, 'ك': 8, 'گ': 8, 'ل': 6,
            'م': 4, 'ن': 2, 'س': 0, 'ع': 10, 'ف': 8, 'ص': 6, 'ق': 4,
            'ر': 8, 'ش': 0, 'ت': 4, 'ة': 4, 'ث': 8, 'خ': 0, 'ذ': 4,
            'ض': 8, 'ظ': 0, 'غ': 4
        };

        function persianizeNumerals(str) {
            const p = ['۰', '۱', '۲', '۳', '۴', '۵', '۶', '۷', '۸', '۹'];
            return str.toString().replace(/\d/g, x => p[x]);
        }

        function calculateAbjad(text, type = 'kabir') {
            const map = type === 'saghir' ? abjadSaghirMap : (type === 'vasit' ? abjadVasitMap : abjadKabirMap);
            let sum = 0;
            let details = [];
            let cleanChars = "";

            for (let char of text) {
                if (char === ' ') {
                    cleanChars += " ";
                    continue;
                }
                const val = map[char];
                if (val !== undefined) {
                    sum += val;
                    const displayVal = val === 0 ? "ساقط" : persianizeNumerals(val);
                    details.push(`[${char} = ${displayVal}]`);
                    cleanChars += char;
                }
            }

            return { n: sum, desc: details.join(" + "), cleanChars };
        }

        function reverseAbjad(numStr) {
            let n = parseInt(numStr);
            if (isNaN(n) || n <= 0) return { str: "", desc: "" };

            const values = [
                {v: 1000, c: 'غ'}, {v: 900, c: 'ظ'}, {v: 800, c: 'ض'}, {v: 700, c: 'ذ'},
                {v: 600, c: 'خ'}, {v: 500, c: 'ث'}, {v: 400, c: 'ت'}, {v: 300, c: 'ش'},
                {v: 200, c: 'ر'}, {v: 100, c: 'ق'}, {v: 90, c: 'ص'}, {v: 80, c: 'ف'},
                {v: 70, c: 'ع'}, {v: 60, c: 'س'}, {v: 50, c: 'ن'}, {v: 40, c: 'م'},
                {v: 30, c: 'ل'}, {v: 20, c: 'ک'}, {v: 10, c: 'ی'}, {v: 9, c: 'ط'},
                {v: 8, c: 'ح'}, {v: 7, c: 'ز'}, {v: 6, c: 'و'}, {v: 5, c: 'ه'},
                {v: 4, c: 'د'}, {v: 3, c: 'ج'}, {v: 2, c: 'ب'}, {v: 1, c: 'ا'}
            ];

            let resultStr = "";
            let resultDesc = [];
            let tempN = n;

            for (let item of values) {
                while (tempN >= item.v) {
                    resultStr += item.c;
                    resultDesc.push(`[${persianizeNumerals(item.v)} = ${item.c}]`);
                    tempN -= item.v;
                }
            }

            return { str: resultStr, desc: resultDesc.join(" + ") };
        }

        // --- UI Logic ---

        let activeHighlightChar = null;

        function switchTab(tabId) {
            const textContent = document.getElementById('text-to-num-content');
            const numContent = document.getElementById('num-to-text-content');
            const textBtn = document.getElementById('tab-btn-text');
            const numBtn = document.getElementById('tab-btn-num');

            if (tabId === 'text-to-num') {
                textContent.classList.remove('hidden');
                numContent.classList.add('hidden');
                textBtn.classList.add('active');
                numBtn.classList.remove('active');
            } else {
                textContent.classList.add('hidden');
                numContent.classList.remove('hidden');
                textBtn.classList.remove('active');
                numBtn.classList.add('active');
            }
        }

        function updateTextToNum() {
            const text = document.getElementById('text-input').value;
            const type = document.getElementById('abjad-type').value;
            const result = calculateAbjad(text, type);

            document.getElementById('abjad-value').textContent = persianizeNumerals(result.n);
            document.getElementById('calculation-details').textContent = result.desc || (text ? "کاراکتر معتبری یافت نشد" : "منتظر ورود متن...");
            
            updateStats(result.cleanChars);
        }

        function updateStats(cleanChars) {
            const container = document.getElementById('letters-stats-container');
            const display = document.getElementById('highlighted-display');
            const originalText = document.getElementById('text-input').value;
            
            if (!originalText.trim()) {
                container.innerHTML = '';
                display.innerHTML = '<span class="opacity-30 italic">متن در اینجا ظاهر می‌شود...</span>';
                return;
            }

            const counts = {};
            for (let char of cleanChars) {
                if (char === ' ') continue;
                counts[char] = (counts[char] || 0) + 1;
            }

            const sortedChars = Object.entries(counts).sort((a, b) => b[1] - a[1]);
            
            container.innerHTML = '';
            sortedChars.forEach(([char, count], index) => {
                const cell = document.createElement('div');
                cell.className = 'char-cell bg-white px-3 py-1 rounded-lg shadow-sm text-sm font-bold flex items-center gap-2';
                if (activeHighlightChar === char || (activeHighlightChar === null && index === 0)) {
                    cell.classList.add('active-highlight');
                    if (activeHighlightChar === null) activeHighlightChar = char;
                }
                
                cell.innerHTML = `<span>${char}</span><span class="text-xs opacity-50 border-r pr-2 mr-1">${persianizeNumerals(count)}</span>`;
                cell.onclick = () => {
                    activeHighlightChar = char;
                    renderHighlightedText(originalText);
                    document.querySelectorAll('.char-cell').forEach(c => c.classList.remove('active-highlight'));
                    cell.classList.add('active-highlight');
                };
                container.appendChild(cell);
            });

            renderHighlightedText(originalText);
        }

        function renderHighlightedText(text) {
            const display = document.getElementById('highlighted-display');
            if (!text) return;
            
            if (!activeHighlightChar) {
                display.textContent = text;
                return;
            }

            const escapedChar = activeHighlightChar.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            const regex = new RegExp(escapedChar, 'g');
            const html = text.replace(regex, `<span class="highlighted-char">${activeHighlightChar}</span>`);
            display.innerHTML = html.replace(/\n/g, '<br>');
        }

        function updateNumToText() {
            const input = document.getElementById('number-input').value;
            const lines = input.split('\n').filter(l => l.trim() !== '');
            
            let finalStr = [];
            let finalDesc = [];

            lines.forEach(line => {
                const num = line.replace(/[^\d]/g, '');
                if (num) {
                    const res = reverseAbjad(num);
                    if (res.str) {
                        finalStr.push(res.str);
                        finalDesc.push(`عدد ${persianizeNumerals(num)}: ${res.desc}`);
                    }
                }
            });

            document.getElementById('reverse-result').innerHTML = finalStr.join(' | ') || '-';
            document.getElementById('reverse-details').innerHTML = finalDesc.join('<br>') || '-';
        }

        // Listeners
        document.getElementById('text-input').addEventListener('input', updateTextToNum);
        document.getElementById('abjad-type').addEventListener('change', updateTextToNum);
        document.getElementById('number-input').addEventListener('input', updateNumToText);

        // Initialization
        window.onload = () => {
            updateTextToNum();
        };
    </script>
</body>
</html>
